<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>BoutTime</title>
    <style>
        :root {
            --ufc: #8ab4ff;
            --pfl: #7dffb2;
            --zuffa: #ff6bd6;
            --boxing: #f5c84b;

            --selected: #ff6bd6;
            --line: rgba(255, 255, 255, .12);
            --muted: rgba(238, 241, 255, .75);
            --panel: rgba(255, 255, 255, .08);
            --panel2: rgba(0, 0, 0, .20);
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
            color: #eef1ff
        }

        .bg {
            min-height: 100vh;
            padding: 18px;
            background: linear-gradient(135deg, #2a184a, #2b3b87 55%, #5a1f7a);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            position: relative;
            overflow: hidden
        }

        .bg::before,
        .bg::after {
            content: "";
            position: absolute;
            inset: -30vmax;
            background: radial-gradient(900px 600px at 20% 20%, #7b2cff66, transparent 55%), radial-gradient(900px 600px at 80% 30%, #3c7bff66, transparent 55%), radial-gradient(700px 500px at 50% 80%, #ff6bd633, transparent 60%);
            filter: blur(18px);
            transform: translate3d(0, 0, 0);
            animation: drift 14s ease-in-out infinite alternate;
            pointer-events: none
        }

        .bg::after {
            opacity: .75;
            animation-duration: 18s;
            animation-direction: alternate-reverse
        }

        @keyframes drift {
            0% {
                transform: translate3d(-2%, -1%, 0) scale(1.02)
            }

            50% {
                transform: translate3d(2%, 1.5%, 0) scale(1.06)
            }

            100% {
                transform: translate3d(-1%, 2%, 0) scale(1.03)
            }
        }

        .shell {
            width: min(1100px, 100%);
            position: relative;
            z-index: 1
        }

        .hero {
            padding: 10px 8px 0;
            margin-bottom: -18px
        }

        .heroTitle {
            font-weight: 950;
            letter-spacing: -0.010em;
            line-height: 1.12;
            font-size: clamp(54px, 8.6vw, 96px);
            margin: 0 0 22px 0;
            display: inline-flex;
            align-items: baseline;
            gap: .16em;
            white-space: nowrap;
            animation: titleFloat 5.5s ease-in-out infinite;
            transform: translateZ(0);
            text-shadow: 0 18px 60px rgba(0, 0, 0, .35);
            padding-bottom: .10em
        }

        @keyframes titleFloat {

            0%,
            100% {
                transform: translateY(0)
            }

            50% {
                transform: translateY(-6px)
            }
        }

        .dot {
            display: inline-block;
            width: .22em;
            height: .22em;
            border-radius: 999px;
            background: linear-gradient(135deg, var(--ufc), var(--boxing));
            box-shadow: 0 10px 30px rgba(0, 0, 0, .25);
            transform: translateY(-.14em);
            flex: 0 0 auto
        }

        .swapLine {
            display: inline-flex;
            align-items: baseline;
            gap: .14em;
            font-weight: 200;
            letter-spacing: -0.02em;
            opacity: .98
        }

        .swapWrap {
            display: inline-flex;
            align-items: baseline;
            vertical-align: baseline;
            height: 1.15em;
            overflow: visible
        }

        .swapLetters {
            display: inline-flex;
            align-items: baseline;
            white-space: nowrap
        }

        .swapChar {
            display: inline-block;
            will-change: transform, opacity, filter
        }

        .swapChar.out {
            animation: charOut .42s cubic-bezier(.2, .9, .2, 1) both
        }

        .swapChar.in {
            animation: charIn .52s cubic-bezier(.2, .9, .2, 1) both
        }

        @keyframes charOut {
            0% {
                transform: translateY(0);
                opacity: 1;
                filter: blur(0)
            }

            100% {
                transform: translateY(-55%);
                opacity: 0;
                filter: blur(6px)
            }
        }

        @keyframes charIn {
            0% {
                transform: translateY(65%);
                opacity: 0;
                filter: blur(8px)
            }

            100% {
                transform: translateY(0);
                opacity: 1;
                filter: blur(0)
            }
        }

        .staticWord {
            opacity: .95;
            padding-bottom: .02em
        }

        .app {
            border-radius: 26px;
            padding: 18px;
            background: var(--panel);
            border: 1px solid var(--line);
            backdrop-filter: blur(14px);
            box-shadow: 0 26px 80px rgba(0, 0, 0, .35)
        }

        .btn {
            padding: 10px 12px;
            border-radius: 14px;
            border: 1px solid var(--line);
            background: rgba(0, 0, 0, .2);
            color: #eef1ff;
            cursor: pointer
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            margin-top: 14px
        }

        @media(max-width:900px) {
            .grid {
                grid-template-columns: 1fr
            }

            .hero {
                margin-bottom: -10px
            }

            .heroTitle {
                white-space: normal
            }
        }

        .panel {
            border-radius: 22px;
            background: var(--panel2);
            border: 1px solid var(--line);
            padding: 14px
        }

        .panelHead {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            gap: 10px;
            align-items: center
        }

        .panelTitle {
            font-weight: 800
        }

        .hint {
            font-size: 12px;
            color: var(--muted)
        }

        .headRight {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap
        }

        .cal-head {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px
        }

        .cal-head button {
            padding: 8px 10px;
            border-radius: 14px;
            border: 1px solid var(--line);
            background: rgba(255, 255, 255, .08);
            color: #eef1ff;
            cursor: pointer
        }

        .cal-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px
        }

        .dow {
            text-align: center;
            font-size: 11px;
            color: var(--muted)
        }

        .day {
            border: 1px solid var(--line);
            background: rgba(255, 255, 255, .06);
            border-radius: 14px;
            padding: 8px;
            min-height: 42px;
            position: relative;
            transition: transform .08s ease, background .08s ease;
            cursor: pointer;
            user-select: none
        }

        .day:hover {
            background: rgba(255, 255, 255, .09);
            transform: translateY(-1px)
        }

        .day.today {
            outline: 2px solid var(--ufc);
            outline-offset: 2px
        }

        .day.selected {
            outline: 2px solid var(--selected);
            outline-offset: 2px
        }

        .day.muted {
            opacity: .35
        }

        .num {
            font-size: 12px;
            font-weight: 800
        }

        .dots {
            position: absolute;
            bottom: 8px;
            left: 8px;
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            max-width: calc(100% - 16px)
        }

        .dotMini {
            width: 7px;
            height: 7px;
            border-radius: 999px;
            flex: 0 0 auto
        }

        .dotMini.ufc {
            background: var(--ufc)
        }

        .dotMini.pfl {
            background: var(--pfl)
        }

        .dotMini.zuffa {
            background: var(--zuffa)
        }

        .dotMini.boxing {
            background: var(--boxing)
        }

        .dotMini.more {
            border: 1px solid var(--line);
            background: rgba(255, 255, 255, .10)
        }

        .events {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 70vh;
            overflow: auto;
            padding-right: 4px
        }

        .card {
            border-radius: 18px;
            border: 1px solid var(--line);
            background: rgba(255, 255, 255, .07);
            padding: 12px
        }

        .tagRow {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center
        }

        .tag {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 999px;
            border: 1px solid var(--line);
            color: var(--muted)
        }

        .tag.ufc {
            border-color: var(--ufc)
        }

        .tag.pfl {
            border-color: var(--pfl)
        }

        .tag.zuffa {
            border-color: var(--zuffa)
        }

        .tag.boxing {
            border-color: var(--boxing)
        }

        .name {
            font-weight: 850;
            margin-top: 6px
        }

        .meta {
            font-size: 13px;
            color: var(--muted);
            margin-top: 4px
        }

        .rowBtns {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px
        }

        .smallBtn {
            padding: 8px 10px;
            border-radius: 14px;
            border: 1px solid var(--line);
            background: rgba(255, 255, 255, .08);
            color: #eef1ff;
            cursor: pointer;
            font-size: 12px
        }

        .linkBtn {
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px
        }

        .pillUnderCal {
            margin-top: 12px;
            display: flex;
            justify-content: flex-start
        }

        .heroPill {
            display: flex;
            gap: 10px;
            align-items: center;
            padding: 10px 12px;
            border-radius: 999px;
            border: 1px solid var(--line);
            background: rgba(255, 255, 255, .07);
            backdrop-filter: blur(14px);
            box-shadow: 0 18px 55px rgba(0, 0, 0, .25);
            white-space: nowrap
        }

        .pillDots {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap
        }

        .pillDot {
            width: 9px;
            height: 9px;
            border-radius: 999px
        }

        .pillDot.ufc {
            background: var(--ufc)
        }

        .pillDot.pfl {
            background: var(--pfl)
        }

        .pillDot.zuffa {
            background: var(--zuffa)
        }

        .pillDot.boxing {
            background: var(--boxing)
        }

        .pillText {
            font-size: 12px;
            color: var(--muted)
        }

        @media (prefers-reduced-motion: reduce) {

            .bg::before,
            .bg::after,
            .heroTitle {
                animation: none !important
            }

            .swapChar {
                animation: none !important
            }
        }
    </style>
</head>

<body>
    <div class="bg">
        <div class="shell">
            <header class="hero">
                <h1 class="heroTitle">
                    <span class="brandWord">BoutTime</span>
                    <span class="dot" aria-hidden="true"></span>
                    <span class="swapLine" aria-label="Fight type">
                        <span class="swapWrap"><span id="swapLetters" class="swapLetters"></span></span>
                        <span class="staticWord">Fights</span>
                    </span>
                </h1>
            </header>

            <div class="app">
                <div class="grid">
                    <div class="panel">
                        <div class="panelHead">
                            <div class="panelTitle">Calendar <span class="hint">- Click a date to view that day</span>
                            </div>
                            <div class="headRight">
                                <button id="today" class="btn">Today</button>
                            </div>
                        </div>

                        <div id="calendar"></div>

                        <div class="pillUnderCal">
                            <div class="heroPill" aria-label="Promotions included">
                                <div class="pillDots" aria-hidden="true">
                                    <span class="pillDot ufc"></span>
                                    <div class="pillText">UFC</div>
                                    <span class="pillDot pfl"></span>
                                    <div class="pillText">PFL</div>
                                    <span class="pillDot zuffa"></span>
                                    <div class="pillText">Zuffa</div>
                                    <span class="pillDot boxing"></span>
                                    <div class="pillText">Boxing</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel">
                        <div class="panelHead">
                            <div class="panelTitle" id="rightTitle">Upcoming</div>
                            <div class="headRight">
                                <button id="viewAllMonth" class="btn" style="display:none">View all events this
                                    month</button>
                            </div>
                        </div>
                        <div id="events" class="events"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        (() => {
            const EVENTS_URL = "upcoming_events.json";
            const REFRESH_MS = 10 * 60 * 1000;

            const calEl = document.getElementById("calendar");
            const eventsEl = document.getElementById("events");
            const rightTitle = document.getElementById("rightTitle");
            const todayBtn = document.getElementById("today");
            const viewAllBtn = document.getElementById("viewAllMonth");

            // Title swap (promo names)
            const swapLetters = document.getElementById("swapLetters");
            const WORDS = ["UFC", "PFL", "Zuffa", "Boxing"];
            let idx = 0;
            const charDelay = 75, outDur = 420, inDur = 520, hold = 1700;

            function setLetters(word, cls) {
                swapLetters.innerHTML = "";
                for (let i = 0; i < word.length; i++) {
                    const s = document.createElement("span");
                    s.className = "swapChar " + cls;
                    s.textContent = word[i];
                    s.style.animationDelay = (i * charDelay) + "ms";
                    swapLetters.appendChild(s);
                }
            }
            function cycle() {
                const current = WORDS[idx];
                const next = WORDS[(idx + 1) % WORDS.length];
                setLetters(current, "out");
                const outTotal = outDur + Math.max(0, (current.length - 1) * charDelay);
                setTimeout(() => {
                    setLetters(next, "in");
                    idx = (idx + 1) % WORDS.length;
                    const inTotal = inDur + Math.max(0, (next.length - 1) * charDelay);
                    setTimeout(cycle, hold + inTotal);
                }, outTotal);
            }
            setLetters(WORDS[0], "in");
            setTimeout(cycle, hold);

            const TZ_EST = "America/New_York";
            const VIEWER_TZ = Intl.DateTimeFormat().resolvedOptions().timeZone || TZ_EST;

            let monthCursor = new Date();
            let selectedDay = null;

            function escapeHtml(s) {
                return String(s ?? "")
                    .replaceAll("&", "&amp;")
                    .replaceAll("<", "&lt;")
                    .replaceAll(">", "&gt;")
                    .replaceAll('"', "&quot;")
                    .replaceAll("'", "&#039;");
            }
            function pad2(n) { return String(n).padStart(2, "0"); }

            function ymdInTZ(date, timeZone) {
                const parts = new Intl.DateTimeFormat("en-CA", {
                    timeZone, year: "numeric", month: "2-digit", day: "2-digit"
                }).formatToParts(date).reduce((a, x) => { a[x.type] = x.value; return a; }, {});
                return `${parts.year}-${parts.month}-${parts.day}`;
            }

            function formatTime(date, timeZone) {
                return new Intl.DateTimeFormat("en-US", {
                    timeZone, weekday: "short", month: "short", day: "numeric",
                    hour: "numeric", minute: "2-digit", hour12: true
                }).format(date);
            }

            function startMonth(d) { return new Date(d.getFullYear(), d.getMonth(), 1); }
            function endMonth(d) { return new Date(d.getFullYear(), d.getMonth() + 1, 0, 23, 59, 59, 999); }
            function addDays(d, n) { const x = new Date(d); x.setDate(x.getDate() + n); return x; }

            function monthLabel(d) {
                return d.toLocaleString(undefined, { month: "long", year: "numeric" });
            }

            function parseEventDate(dateStr, timeStr) {
                const s = String(dateStr || "").trim();
                const t = String(timeStr || "").trim();

                let datePart = s;
                // If it doesn't have a year, assume current year or next if it makes sense
                // Our scraper output usually has "Saturday, March 28"
                if (!/\b\d{4}\b/.test(s)) {
                    const now = new Date();
                    const year = now.getFullYear();
                    datePart = `${s}, ${year}`;
                }

                let dateTimeStr = datePart;
                let hasRealTime = false;

                if (t && t.toLowerCase() !== "n/a") {
                    hasRealTime = true;
                    // timeStr is like "6:00 PM ET"
                    const cleanedTime = t.replace(/\sET\b/i, " GMT-0500");
                    dateTimeStr = `${datePart} ${cleanedTime}`;
                } else {
                    dateTimeStr = `${datePart} 12:00:00`;
                }

                const d = new Date(dateTimeStr);

                // Final check - if we assumed this year but it's long past, maybe it's next year? 
                // But the scraper usually filters past events, so current year is a safe default.

                if (!Number.isNaN(d.getTime())) {
                    return { dateObj: d, hasRealTime };
                }

                return { dateObj: new Date(), hasRealTime: false };
            }

            function normalizePromotion(p) {
                const t = String(p || "").trim();
                const l = t.toLowerCase();
                if (l.includes("ufc")) return "UFC";
                if (l.includes("pfl")) return "PFL";
                if (l.includes("zuffa")) return "Zuffa";
                if (l.includes("boxing")) return "Boxing";
                if (l.includes("box")) return "Boxing";
                return t || "Boxing";
            }

            function promoClass(label) {
                const l = String(label || "").toLowerCase();
                if (l === "ufc") return "ufc";
                if (l === "pfl") return "pfl";
                if (l === "zuffa") return "zuffa";
                return "boxing";
            }

            // repo schema: event_name, date_and_time, location, promotion
            function normalizeInputEvents(raw) {
                const out = [];
                for (const item of (raw || [])) {
                    const name = (item.event_name ?? item.name ?? "").toString().trim() || "Event";
                    const dateRaw = (item.date ?? "").toString().trim();
                    const timeRaw = (item.time ?? "N/A").toString().trim();
                    const venue = (item.location ?? "").toString().trim();
                    const promotionRaw = (item.promotion ?? item.sport ?? "").toString().trim();

                    const label = normalizePromotion(promotionRaw);
                    const { dateObj, hasRealTime } = parseEventDate(dateRaw, timeRaw);
                    const dayKey = ymdInTZ(dateObj, VIEWER_TZ);

                    out.push({
                        label,                 // UFC / PFL / Zuffa / Boxing
                        promoCls: promoClass(label),
                        name,
                        dateObj,
                        hasRealTime,
                        time: timeRaw,
                        venue,
                        dayKey
                    });
                }

                const seen = new Set();
                return out.filter(e => {
                    const k = `${e.label}|${e.name}|${e.dayKey}|${e.venue}`;
                    if (seen.has(k)) return false;
                    seen.add(k);
                    return true;
                }).sort((a, b) => a.dateObj - b.dateObj);
            }

            let ALL_EVENTS = [];

            async function loadEvents() {
                try {
                    const url = EVENTS_URL + (EVENTS_URL.includes("?") ? "&" : "?") + "t=" + Date.now();
                    const res = await fetch(url, { cache: "no-store" });
                    if (!res.ok) throw new Error("HTTP " + res.status);
                    const raw = await res.json();
                    ALL_EVENTS = normalizeInputEvents(raw);
                    render();
                } catch (e) {
                    if (!ALL_EVENTS.length) {
                        eventsEl.innerHTML = `<div class="meta">Could not load events</div>`;
                    }
                }
            }

            function eventsForMonth(d) {
                const start = startMonth(d).getTime();
                const end = endMonth(d).getTime();
                return ALL_EVENTS.filter(e => {
                    const t = e.dateObj.getTime();
                    return t >= start && t <= end;
                }).sort((a, b) => a.dateObj - b.dateObj);
            }

            function toGCalEventEditUrl(e) {
                const title = `${e.label}: ${e.name}`;
                const details = e.venue ? `Location: ${e.venue}` : "";

                const start = e.hasRealTime ? new Date(e.dateObj) : new Date(`${e.dayKey}T17:00:00Z`);
                const end = new Date(start.getTime() + 3 * 60 * 60 * 1000);

                const fmt = (d) => {
                    const y = d.getUTCFullYear();
                    const m = pad2(d.getUTCMonth() + 1);
                    const da = pad2(d.getUTCDate());
                    const hh = pad2(d.getUTCHours());
                    const mm = pad2(d.getUTCMinutes());
                    const ss = pad2(d.getUTCSeconds());
                    return `${y}${m}${da}T${hh}${mm}${ss}Z`;
                };

                const params = new URLSearchParams();
                params.set("text", title);
                params.set("dates", `${fmt(start)}/${fmt(end)}`);
                if (details) params.set("details", details);

                return `https://calendar.google.com/calendar/r/eventedit?${params.toString()}`;
            }

            function cardHtml(e) {
                const displayTime = (e.time === "N/A") ? "TBA" : e.time;
                const timeLine = `Time: ${displayTime}`;
                const where = (e.venue || "").trim();
                const url = toGCalEventEditUrl(e);

                return `
        <div class="card">
          <div class="tagRow">
            <span class="tag ${e.promoCls}">${escapeHtml(e.label)}</span>
          </div>
          <div class="name">${escapeHtml(e.name)}</div>
          <div class="meta">${escapeHtml(timeLine)}</div>
          ${where ? `<div class="meta">${escapeHtml(where)}</div>` : ``}
          <div class="rowBtns">
            <a class="smallBtn linkBtn" href="${escapeHtml(url)}" target="_blank" rel="noopener">Add to Google Calendar</a>
          </div>
        </div>
      `;
            }

            function repeatDots(cls, n, cap = 6) {
                const count = Math.min(n || 0, cap);
                let html = "";
                for (let i = 0; i < count; i++) html += `<span class="dotMini ${cls}"></span>`;
                if ((n || 0) > cap) html += `<span class="dotMini more" title="+${(n - cap)} more"></span>`;
                return html;
            }

            function renderCalendar() {
                const m0 = startMonth(monthCursor);
                const start = addDays(m0, -m0.getDay());
                const days = [...Array(42)].map((_, i) => addDays(start, i));
                const todayKey = ymdInTZ(new Date(), VIEWER_TZ);

                const monthEvents = eventsForMonth(monthCursor);
                const dayKinds = new Map();

                for (const e of monthEvents) {
                    const k = e.dayKey;
                    const cur = dayKinds.get(k) || { ufc: 0, pfl: 0, zuffa: 0, boxing: 0 };
                    cur[e.promoCls] = (cur[e.promoCls] || 0) + 1;
                    dayKinds.set(k, cur);
                }

                calEl.innerHTML = `
        <div class="cal-head">
          <button id="prev">←</button>
          <div>${monthLabel(m0)}</div>
          <button id="next">→</button>
        </div>
        <div class="cal-grid">
          ${["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"].map(d => `<div class="dow">${d}</div>`).join("")}
          ${days.map(d => {
                    const key = ymdInTZ(d, VIEWER_TZ);
                    const kinds = dayKinds.get(key);

                    const dots = kinds ? `<div class="dots">
              ${repeatDots("ufc", kinds.ufc)}
              ${repeatDots("pfl", kinds.pfl)}
              ${repeatDots("zuffa", kinds.zuffa)}
              ${repeatDots("boxing", kinds.boxing)}
            </div>` : ``;

                    const cls = [
                        "day",
                        d.getMonth() !== m0.getMonth() ? "muted" : "",
                        key === todayKey ? "today" : "",
                        key === selectedDay ? "selected" : ""
                    ].filter(Boolean).join(" ");

                    return `<div class="${cls}" data-day="${key}">
              <div class="num">${d.getDate()}</div>
              ${dots}
            </div>`;
                }).join("")}
        </div>
      `;

                document.getElementById("prev").onclick = () => {
                    monthCursor = new Date(monthCursor.getFullYear(), monthCursor.getMonth() - 1, 1);
                    selectedDay = null;
                    viewAllBtn.style.display = "none";
                    render();
                };

                document.getElementById("next").onclick = () => {
                    monthCursor = new Date(monthCursor.getFullYear(), monthCursor.getMonth() + 1, 1);
                    selectedDay = null;
                    viewAllBtn.style.display = "none";
                    render();
                };

                calEl.querySelectorAll(".day").forEach(cell => {
                    cell.onclick = () => {
                        selectedDay = cell.dataset.day;
                        viewAllBtn.style.display = "inline-block";
                        renderCalendar();
                        renderDayList(selectedDay);
                    };
                });
            }

            function renderUpcoming() {
                rightTitle.textContent = `Upcoming (${monthLabel(startMonth(monthCursor))})`;
                viewAllBtn.style.display = "none";

                const nowKey = ymdInTZ(new Date(), VIEWER_TZ);
                const monthEvents = eventsForMonth(monthCursor);

                const viewingThisMonth =
                    startMonth(monthCursor).getFullYear() === startMonth(new Date()).getFullYear() &&
                    startMonth(monthCursor).getMonth() === startMonth(new Date()).getMonth();

                const list = viewingThisMonth ? monthEvents.filter(e => e.dayKey >= nowKey) : monthEvents;

                eventsEl.innerHTML = list.map(cardHtml).join("") || `<div class="meta">No fights found for this month</div>`;
            }

            function renderDayList(dayKey) {
                rightTitle.textContent = `${dayKey}`;
                const monthEvents = eventsForMonth(monthCursor);
                const list = monthEvents.filter(e => e.dayKey === dayKey);
                eventsEl.innerHTML = list.map(cardHtml).join("") || `<div class="meta">No fights</div>`;
            }

            function render() {
                renderCalendar();
                if (selectedDay) renderDayList(selectedDay);
                else renderUpcoming();
            }

            todayBtn.onclick = () => {
                const now = new Date();
                monthCursor = new Date(now.getFullYear(), now.getMonth(), 1);
                selectedDay = ymdInTZ(now, VIEWER_TZ);
                viewAllBtn.style.display = "inline-block";
                render();
            };

            viewAllBtn.onclick = () => {
                selectedDay = null;
                viewAllBtn.style.display = "none";
                render();
            };

            render();
            loadEvents();
            setInterval(loadEvents, REFRESH_MS);
            window.addEventListener("focus", loadEvents);
            document.addEventListener("visibilitychange", () => { if (!document.hidden) loadEvents(); });
        })();
    </script>
</body>

</html>